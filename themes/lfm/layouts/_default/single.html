{{ define "main" }}
<article class="article-single" itemscope itemtype="https://schema.org/Article">

  <!-- Reading Progress Bar -->
  <div class="reading-progress" id="reading-progress"></div>

  <!-- Article Header -->
  <header class="article-header">
    {{ if .Params.tags }}
    <div class="article-category">
      {{ index .Params.tags 0 }}
    </div>
    {{ end }}

    <h1 class="article-title" itemprop="headline">{{ .Title }}</h1>

    {{ with .Params.description }}
    <p class="article-subtitle">{{ . }}</p>
    {{ end }}

    <div class="article-meta">
      <div class="meta-row">
        <time datetime="{{ .Date.Format "2006-01-02" }}" itemprop="datePublished">
          <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          {{ .Date.Format "January 2, 2006" }}
        </time>

        {{ with .Params.author }}
        <span class="meta-separator">•</span>
        <span class="article-author" itemprop="author">
          <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          {{ . }}
        </span>
        {{ end }}

        <span class="meta-separator">•</span>
        <span class="reading-time">
          <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          {{ math.Round (div (countwords .Content) 200.0) }} min read
        </span>
      </div>
    </div>
  </header>

  <!-- Decorative Divider -->
  <div class="article-divider">
    <svg viewBox="0 0 100 20" preserveAspectRatio="none">
      <path d="M0,10 L40,10 L50,0 L60,10 L100,10" stroke="currentColor" fill="none" stroke-width="1"/>
    </svg>
  </div>

  <!-- Article Content -->
  <div class="article-content" itemprop="articleBody">
    {{ .Content }}
  </div>

  <!-- Article Footer -->
  <footer class="article-footer">
    {{ if .Params.tags }}
    <div class="article-tags-section">
      <span class="tags-label">
        <svg class="tags-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
          <line x1="7" y1="7" x2="7.01" y2="7"></line>
        </svg>
        Tagged
      </span>
      <div class="article-tags">
        {{ range .Params.tags }}
        <span class="article-tag">{{ . }}</span>
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- Share Section -->
    <div class="article-share">
      <span class="share-label">Share this article</span>
      <div class="share-buttons">
        <a href="https://twitter.com/intent/tweet?text={{ .Title | urlquery }}&url={{ .Permalink | urlquery }}" target="_blank" rel="noopener" class="share-btn" aria-label="Share on Twitter">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
        </a>
        <a href="https://www.reddit.com/submit?url={{ .Permalink | urlquery }}&title={{ .Title | urlquery }}" target="_blank" rel="noopener" class="share-btn" aria-label="Share on Reddit">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
          </svg>
        </a>
        <button class="share-btn copy-link" onclick="copyLink()" aria-label="Copy link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Author Bio (if exists) -->
    {{ if .Params.authorBio }}
    <div class="author-bio">
      <div class="author-bio-content">
        <span class="bio-label">About the Author</span>
        <p>{{ .Params.authorBio }}</p>
      </div>
    </div>
    {{ end }}
  </footer>

  <!-- Related Articles (if available) -->
  {{ $related := .Site.RegularPages.Related . | first 3 }}
  {{ with $related }}
  <aside class="related-articles">
    <h3 class="related-title">
      <svg class="related-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
      </svg>
      Continue Reading
    </h3>
    <div class="related-grid">
      {{ range . }}
      <a href="{{ .RelPermalink }}" class="related-card">
        <span class="related-card-date">{{ .Date.Format "Jan 2, 2006" }}</span>
        <h4 class="related-card-title">{{ .Title }}</h4>
        {{ with .Params.description }}
        <p class="related-card-excerpt">{{ . | truncate 100 }}</p>
        {{ end }}
      </a>
      {{ end }}
    </div>
  </aside>
  {{ end }}

</article>

<!-- Reading Progress Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const progressBar = document.getElementById('reading-progress');
  const article = document.querySelector('.article-content');

  if (progressBar && article) {
    window.addEventListener('scroll', function() {
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      const start = articleTop - windowHeight;
      const end = articleTop + articleHeight - windowHeight;

      let progress = 0;
      if (scrollTop > start && scrollTop < end) {
        progress = ((scrollTop - start) / (end - start)) * 100;
      } else if (scrollTop >= end) {
        progress = 100;
      }

      progressBar.style.width = progress + '%';
    });
  }
});

function copyLink() {
  navigator.clipboard.writeText(window.location.href);
  const btn = document.querySelector('.copy-link');
  btn.classList.add('copied');
  setTimeout(() => btn.classList.remove('copied'), 2000);
}
</script>
{{ end }}
