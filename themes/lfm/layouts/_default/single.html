{{ define "main" }}
<article class="article-single" itemscope itemtype="https://schema.org/Article">

  <!-- Reading Progress Bar -->
  <div class="reading-progress" id="reading-progress"></div>

  <!-- Article Header -->
  <header class="article-header">
    {{ if .Params.tags }}
    <div class="article-category">
      {{ index .Params.tags 0 }}
    </div>
    {{ end }}

    <h1 class="article-title" itemprop="headline">{{ .Title }}</h1>

    {{ with .Params.description }}
    <p class="article-subtitle">{{ . }}</p>
    {{ end }}

    <div class="article-meta">
      <time datetime="{{ .Date.Format "2006-01-02" }}" itemprop="datePublished">
        {{ .Date.Format "January 2, 2006" }}
      </time>
      {{ with .Params.author }}
      <span class="meta-separator">•</span>
      <span class="article-author" itemprop="author">{{ . }}</span>
      {{ end }}
      <span class="meta-separator">•</span>
      <span class="reading-time">{{ math.Round (div (countwords .Content) 200.0) }} min read</span>
    </div>
  </header>

  <!-- Article Content -->
  <div class="article-content" itemprop="articleBody">
    {{ .Content }}
  </div>

  <!-- Article Footer -->
  <footer class="article-footer">
    {{ if .Params.tags }}
    <div class="article-tags-section">
      <span class="tags-label">Tagged</span>
      <div class="article-tags">
        {{ range .Params.tags }}
        <span class="article-tag">{{ . }}</span>
        {{ end }}
      </div>
    </div>
    {{ end }}
  </footer>

  <!-- Related Articles -->
  {{ $related := .Site.RegularPages.Related . | first 3 }}
  {{ with $related }}
  <aside class="related-articles">
    <h3 class="related-title">Continue Reading</h3>
    <div class="related-grid">
      {{ range . }}
      <a href="{{ .RelPermalink }}" class="related-card">
        <span class="related-card-date">{{ .Date.Format "Jan 2, 2006" }}</span>
        <h4 class="related-card-title">{{ .Title }}</h4>
        {{ with .Params.description }}
        <p class="related-card-excerpt">{{ . | truncate 100 }}</p>
        {{ end }}
      </a>
      {{ end }}
    </div>
  </aside>
  {{ end }}

</article>

<!-- Reading Progress Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const progressBar = document.getElementById('reading-progress');
  const article = document.querySelector('.article-content');

  if (progressBar && article) {
    window.addEventListener('scroll', function() {
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      const start = articleTop - windowHeight;
      const end = articleTop + articleHeight - windowHeight;

      let progress = 0;
      if (scrollTop > start && scrollTop < end) {
        progress = ((scrollTop - start) / (end - start)) * 100;
      } else if (scrollTop >= end) {
        progress = 100;
      }

      progressBar.style.width = progress + '%';
    });
  }
});
</script>
{{ end }}
